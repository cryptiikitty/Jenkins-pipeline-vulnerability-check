import argparse
import json
import time

import requests
from requests.structures import CaseInsensitiveDict

parser = argparse.ArgumentParser()
parser.add_argument("-f", "--file_path", help="File path of the data input")
parser.add_argument("-u", "--base_url", help="Base url")

args = parser.parse_args()
base_url = args.base_url

headers = CaseInsensitiveDict()

with open(args.file_path, 'r') as file:
    urls = file.readlines()
    urls = [url.strip() for url in urls]
data = {"urls": urls}
json_data = json.dumps(data)
#print(json_data)

resp = requests.post(base_url, headers=headers, data=json_data)
print("Status Code: ", resp.status_code)

check_status = True
location = resp.headers["location"]
check_url = base_url+"/"+location
while check_status:
    resp = requests.get(check_url)
    respJson = resp.json()
    scanstatus = respJson["scan_status"]
    if scanstatus in ["succeeded", "failed"]:
        check_url = False
        break
    else:
        time.sleep(5)
issue_events = respJson['issue_events']
print("no of issue: "+str(len(issue_events)))
for issue in issue_events:
    print("\n\nVulnerability Name: "+issue['issue']['name']+",""\nSeverity: "+issue['issue']['severity']+",""\nOrigin: " +
          issue['issue']['origin']+",""\nPath :"+issue['issue']['path']+",""\nConfidence: "+issue['issue']['confidence'])
